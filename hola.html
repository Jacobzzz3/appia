<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Pronóstico - Starbucks</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Fuentes personalizadas para el look & feel */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lato:wght@400;700&display=swap');
        
        body {
            font-family: 'Lato', sans-serif;
            background-color: #f0f4f8; /* Un gris claro para el fondo */
        }
        
        h1, h2, h3, h4 {
            font-family: 'Poppins', sans-serif;
        }

        /* Colores de la marca Starbucks */
        .bg-starbucks-green {
            background-color: #00704A; /* Verde principal */
        }
        .text-starbucks-green {
            color: #00704A;
        }
        .bg-starbucks-dark {
            background-color: #1e3932; /* Verde oscuro para texto */
        }
        .text-starbucks-dark {
            color: #1e3932;
        }
        .bg-starbucks-accent {
            background-color: #D4E9E2; /* Verde claro de acento */
        }

        /* Estilo para el spinner de carga */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00704A;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-2xl overflow-hidden my-8">
        
        <!-- 1. Encabezado de la Aplicación -->
        <header class="bg-starbucks-green text-white p-6 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <img src="https://i.imgur.com/v8pGrq5.png" alt="Logo de Starbucks" class="h-12 w-12 rounded-full bg-white p-1">
                <div>
                    <h1 class="text-2xl font-bold">Portal de Gestión de Demanda</h1>
                    <p class="text-sm opacity-90">Herramienta Interna de Pronóstico</p>
                </div>
            </div>
            <div class="text-right">
                <p class="font-semibold">Gerente: C. Escobar</p>
                <p class="text-xs">Sucursal: <span class="font-bold">Avenida Colón 608</span></p>
            </div>
        </header>

        <!-- 2. Cuerpo Principal -->
        <main class="p-8 md:p-12">
            
            <!-- 2.1 Panel de Control (Input) -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 flex flex-col md:flex-row items-center justify-between gap-4">
                <div>
                    <label for="forecast-date" class="block text-sm font-medium text-gray-700 mb-1">Seleccionar Fecha para Pronóstico:</label>
                    <input type="date" id="forecast-date" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-starbucks-green">
                </div>
                <button id="generate-button" class="w-full md:w-auto bg-starbucks-green text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-starbucks-dark transition-colors duration-300 flex items-center justify-center space-x-2">
                    <i class="fas fa-brain"></i>
                    <span>Generar Pronóstico</span>
                </button>
            </div>

            <!-- 2.2 Área de Resultados (Output) -->
            <div id="results-area" class="mt-8 hidden">
                
                <!-- Spinner de Carga -->
                <div id="loading-spinner" class="flex flex-col items-center justify-center p-12 text-starbucks-green hidden">
                    <div class="loader"></div>
                    <p class="mt-4 font-semibold">Analizando patrones... (Ejecutando modelo RF)</p>
                </div>

                <!-- Contenido de Resultados -->
                <div id="forecast-content" class="hidden">
                    <h2 class="text-2xl font-bold text-starbucks-dark mb-4">
                        Pronóstico de Venta Total para: <span id="result-date" class="text-starbucks-green"></span>
                    </h2>

                    <!-- Tarjeta de KPI Principal -->
                    <div class="bg-starbucks-accent border border-green-200 rounded-lg p-8 text-center mb-6">
                        <p class="text-lg font-semibold text-starbucks-dark">Venta Total Pronosticada</p>
                        <p id="forecast-value" class="text-6xl font-bold text-starbucks-green my-2">$62,150.40</p>
                        <p id="confidence-range" class="text-sm text-gray-600">Rango de Confianza (MAE): $56,600 - $67,700</p>
                    </div>

                    <!-- Recomendaciones Accionables -->
                    <h3 class="text-xl font-bold text-starbucks-dark mb-4">Recomendaciones del Modelo</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Inventario -->
                        <div class="bg-white border border-gray-200 p-6 rounded-lg shadow-sm">
                            <div class="flex items-center space-x-3 mb-3">
                                <i class="fas fa-box-open text-starbucks-green text-2xl"></i>
                                <h4 class="text-lg font-semibold text-starbucks-dark">Inventario y Pedidos</h4>
                            </div>
                            <p class="text-sm text-gray-700">El modelo predice una demanda <strong id="demand-level" class="text-red-600">ALTA</strong>.</p>
                            <ul class="list-disc list-inside text-sm text-gray-700 mt-2 space-y-1">
                                <li>Asegurar stock de productos perecederos clave (Leche, alimentos frescos).</li>
                                <li>Riesgo de **Falta de Stock** si no se ajusta el pedido.</li>
                            </ul>
                        </div>
                        <!-- Personal -->
                        <div class="bg-white border border-gray-200 p-6 rounded-lg shadow-sm">
                            <div class="flex items-center space-x-3 mb-3">
                                <i class="fas fa-users text-starbucks-green text-2xl"></i>
                                <h4 class="text-lg font-semibold text-starbucks-dark">Planificación de Personal</h4>
                            </div>
                            <p id="staff-recommendation" class="text-sm text-gray-700">Se espera un alza del 18% vs. el promedio.</p>
                            <ul class="list-disc list-inside text-sm text-gray-700 mt-2 space-y-1">
                                <li>Reforzar el turno de tarde (15:00 - 19:00).</li>
                                <li>Asignar un barista extra a bebidas frías.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- Lógica del Mockup ---

        const dateInput = document.getElementById('forecast-date');
        const generateButton = document.getElementById('generate-button');
        const resultsArea = document.getElementById('results-area');
        const loadingSpinner = document.getElementById('loading-spinner');
        const forecastContent = document.getElementById('forecast-content');

        // Referencias a los elementos de resultado
        const resultDateEl = document.getElementById('result-date');
        const forecastValueEl = document.getElementById('forecast-value');
        const confidenceRangeEl = document.getElementById('confidence-range');
        const demandLevelEl = document.getElementById('demand-level');
        const staffRecommendationEl = document.getElementById('staff-recommendation');

        // Formateador de moneda (basado en los $ del informe)
        const currencyFormatter = new Intl.NumberFormat('es-CL', {
            style: 'currency',
            currency: 'CLP',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        });

        // 1. Establecer la fecha por defecto a "mañana"
        const setTomorrowDate = () => {
            const today = new Date();
            // Estamos en Chile (UTC-3), pero JS usa el local del navegador. 
            // Para asegurar que "mañana" sea correcto, ajustamos la zona horaria.
            // Para el mockup, un simple setDate es suficiente.
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            // Formatear a YYYY-MM-DD para el input[type=date]
            const yyyy = tomorrow.getFullYear();
            const mm = String(tomorrow.getMonth() + 1).padStart(2, '0'); // Meses son 0-11
            const dd = String(tomorrow.getDate()).padStart(2, '0');
            
            dateInput.value = `${yyyy}-${mm}-${dd}`;
        };
        
        setTomorrowDate();

        // 2. Lógica del botón "Generar Pronóstico"
        generateButton.addEventListener('click', () => {
            // Ocultar resultados anteriores y mostrar spinner
            resultsArea.style.display = 'block';
            forecastContent.style.display = 'none';
            loadingSpinner.style.display = 'flex';
            generateButton.disabled = true;
            generateButton.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Generando...';

            // Simular el tiempo de ejecución del modelo (1.5 segundos)
            setTimeout(simulateModelRun, 1500);
        });

        // 3. Simulación del Modelo (Datos Aleatorios pero realistas)
        const simulateModelRun = () => {
            const selectedDate = new Date(dateInput.value + 'T12:00:00'); // Ajustar zona horaria
            const dayOfWeek = selectedDate.getDay(); // 0=Domingo, 6=Sábado

            // --- Simulación de Resultados ---
            // Basado en el informe: Promedio $60,082 y MAE $13,201 o $5,553.
            // Usaremos el promedio de $60k como base.
            let baseSale = 58000;
            let noise = (Math.random() - 0.5) * 15000; // Ruido aleatorio
            
            // Los fines de semana (Sáb/Dom) y Viernes venden más
            if (dayOfWeek === 0 || dayOfWeek === 5 || dayOfWeek === 6) {
                baseSale = 65000;
                noise = (Math.random() - 0.4) * 10000;
            }

            const forecast = baseSale + noise;
            
            // Usamos el MAE de $5.5k para el rango de confianza
            const mae = 5553; 
            const lowerBound = forecast - mae;
            const upperBound = forecast + mae;

            let demandLevel;
            let staffRec;
            if (forecast > 63000) {
                demandLevel = "ALTA";
                demandLevelEl.className = "text-red-600 font-bold";
                staffRec = "Se espera un alza del 20%+ vs. el promedio.";
            } else if (forecast < 55000) {
                demandLevel = "BAJA";
                demandLevelEl.className = "text-blue-600 font-bold";
                staffRec = "Demanda un 10% por debajo del promedio.";
            } else {
                demandLevel = "MODERADA";
                demandLevelEl.className = "text-yellow-600 font-bold";
                staffRec = "Demanda dentro del rango esperado.";
            }

            // --- Actualizar la UI ---
            resultDateEl.textContent = selectedDate.toLocaleDateString('es-CL', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            forecastValueEl.textContent = currencyFormatter.format(forecast);
            confidenceRangeEl.textContent = `Rango de Confianza (MAE): ${currencyFormatter.format(lowerBound)} - ${currencyFormatter.format(upperBound)}`;
            demandLevelEl.textContent = demandLevel;
            staffRecommendationEl.textContent = staffRec;

            // Ocultar spinner y mostrar resultados
            loadingSpinner.style.display = 'none';
            forecastContent.style.display = 'block';
            generateButton.disabled = false;
            generateButton.innerHTML = '<i class="fas fa-brain"></i> Generar Pronóstico';
        };

    </script>

</body>
</html>